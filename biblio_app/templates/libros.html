<!DOCTYPE html>
{% extends "index.html" %}
{% load static %}

{% block main_content %}
<div class="container-flex text-center justify-content-center allign-items-center" style="padding-top: 20px;">
    <div class="row justify-content-center align-middle" style="margin-top: 10px; height:60px;">
        <div class="col-md-4 text-center">
            <h4 style="margin-top: 15px;"> Registra un nuevo libro</h4>
        </div>
        <div class="col-md-8">
            <h4>Buscar libros</h4>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-md-4">
        <div class="container" style="overflow-y: auto; height: 600px;">
            <h6>Los campos con * son obligatorios</h6>
            <form class="d-flex" action="/libro/agregar/" method="post">
                {% csrf_token %}
                <table class="table">
                    <tr>
                        <td style="text-align:left; vertical-align:middle; padding-left:15px;">Titulo* : </td>
                        <td><input type="text" class="form-control" name="titulo"></td>
                    </tr>
                    <tr>
                        <td style="text-align:left; vertical-align:middle; padding-left:15px;">Autor* : </td>
                        <td><input type="text" class="form-control" name="autor"></td>
                    </tr>
                    <tr>
                        <td style="text-align:left; vertical-align:middle; padding-left:15px;">Editorial* : </td>
                        <td><input type="text" class="form-control" name="editorial"></td>
                    </tr>
                    <tr>
                        <td style="text-align:left; vertical-align:middle; padding-left:15px;">Ilustrador : </td>
                        <td><input type="text" class="form-control" name="ilustrador"></td>
                    </tr>
                    <tr>
                        <td style="text-align:left; vertical-align:middle; padding-left:15px;">Numero tomo : </td>
                        <td><input type="text" class="form-control" name="numtomo"></td>
                    </tr>
                    <tr>
                        <td style="text-align:left; vertical-align:middle; padding-left:15px;">Clasificacion Dewey : </td>
                        <td><input type="text" class="form-control" name="ubicacion"></td>
                    </tr>
                    <tr>
                        <td style="text-align:left; vertical-align:middle; padding-left:15px;">Publico dirigido : </td>
                        <td><input type="text" class="form-control" name="publico"></td>
                    </tr>
                    <tr>
                        <td style="text-align:left; vertical-align:middle; padding-left:15px;">Fecha publicacion : </td>
                        <td><input type="number" class="form-control" name="fechapubl"></td>  <!-- Cambiado a input type="number" -->
                    </tr>
                    <tr>
                        <td style="text-align:left; vertical-align:middle; padding-left:15px;">Caracteristicas Especiales : </td>
                        <td><textarea class="form-control" name="caracteristicas"></textarea></td>
                    </tr>
                    {% if user.is_authenticated %}
                    <tr>
                        <td colspan="2" style="align-items: center; align-self: center;"><button class="btn btn-primary" type="submit" style="align-self: center;"> Agregar libro</button></td>
                    </tr>
                    {% endif %}
                </table>
            </form>
            {% if user.is_authenticated %}
            <form class="d-flex" action="/libro/agregar-copia/" method="post">
                {% csrf_token %}
                <table class="table">
                    <tr>
                        <td style="text-align:left; vertical-align:middle; padding-left:15px;">Clave del libro* : </td>
                        <td><input type="text" class="form-control" name="codigolibro"></td>
                    </tr>
                    <tr>
                        <td colspan="2" style="align-items: center; align-self: center;"><button class="btn btn-primary" type="submit" style="align-self: center;"> Agregar copia</button></td>
                    </tr>
                </table>
            </form>
            <form class="d-flex" action="/libro/cargar_excel" method="post" enctype="multipart/form-data">
                {% csrf_token %}
                <input type="file" name="excel_file">
                <button class="btn btn-primary" type="submit" style="align-self: center;"> Cargar desde Excel</button>
            </form>            
            <button class="btn btn-danger" type="button" onclick="confirmarBorrarlibros()"> Borrar todos los libros</button>
            {% endif %}
        </div>
    </div>
    <div class="col-md-8">
        <div class="row">
            <nav class="navbar bg-body-light">
                <div class="container-fluid justify-content-center align-items-center">
                    <form class="d-flex" role="search" action="libro" method="get">
                        <input class="form-control me-2" type="search" placeholder="Buscar" aria-label="Search" name="q" value="{{ request.GET.q }}">
                        <button class="btn btn-outline-success" type="submit">Buscar</button>
                    </form>
                </div>
            </nav>
            <div class="row" style="margin-top: 20 px;">
                <p>{{ libros|length }} libros registrados</p>
            </div>
            <div class="row" style="margin-top: 20px;">
                <div class="container" style="overflow-y:auto ;">
                    <table class="table table-hover">
                        <thead>
                            <td>Clave</td>
                            <td>Titulo</td>
                            <td>Autor</td>
                            <td>Editorial</td>
                            <td>Fecha de Publicación</td>
                            <td>Ilustrador</td>
                            <td>Acciones</td>  <!-- Nueva celda para Acciones -->
                        </thead>
                        <tbody>
                            {% for libro in libros %}
                            <tr>
                                <td>
                                    {{ libro.codigolibro|stringformat:"06d" }}
                                </td>
                                <td>{{ libro.titulo }}</td>
                                <td>{{ libro.autor }}</td>
                                <td>{{ libro.editorial }}</td>
                                <td>{{ libro.fechapublicacion }}</td>
                                <td>{{ libro.ilustrador }}</td>
                                <td>
                                    {% if user.is_authenticated %}
                                    <a href="{% url 'editar_libro' codigolibro=libro.codigolibro %}" class="btn btn-warning"><i class="bi bi-pencil"></i>editar</a>
                                    <a href="{% url 'eliminar_libro' codigolibro=libro.codigolibro %}" class="btn btn-danger"><i class="fa-regular fa-trash-can"></i>eliminar</a>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    function confirmarBorrarlibros() {
        if (confirm("¿Estás seguro de que quieres borrar a todos los libros?")) {
            // Si el usuario confirma, redirige al servidor para borrar los datos
            window.location.href = "/libro/borrar_todos";
        } else {
            // Si el usuario cancela, no hagas nada
            // Puedes agregar un mensaje o realizar alguna acción adicional si lo deseas
        }
    }
</script>
{% endblock %}
